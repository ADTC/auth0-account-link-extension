module.exports=function(n){function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t={};return e.m=n,e.c=t,e.i=function(n){return n},e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:r})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=21)}([function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(51);e.default=(0,r.config)()},function(n,e,t){"use strict";var r=t(55);r.emitErrs=!0;var o=new r.Logger({transports:[new r.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});n.exports=o},function(n,e,t){n.exports=!t(3)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e){var t=n.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},function(n,e){n.exports=function(n){return"object"==typeof n?null!==n:"function"==typeof n}},function(n,e){n.exports=require("auth0-extension-hapi-tools@1.2.0")},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(e,"__esModule",{value:!0}),e.uninstall=e.install=void 0;var o=t(23),i=r(o),u=t(17),c=r(u),a="auth0-account-link-extension",s=function(n){return n.find(function(n){return n.name===a})},l=function(n,e){var t=n.create,r=n.update;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=n.find(function(n){return n.name===a});return o?r({id:o.id},e):t((0,i.default)({stage:"login_success"},e))}},f=function(n){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=s(e);t&&n.delete({id:t.id})}},d=function(n,e){var t={name:a,script:(0,c.default)(e),enabled:!0};return n.getAll().then(l(n,t))},p=function(n){return n.getAll().then(f(n))};e.install=d,e.uninstall=p},function(n,e){var t=n.exports={version:"2.5.0"};"number"==typeof __e&&(__e=t)},function(n,e){n.exports=function(n){if(void 0==n)throw TypeError("Can't call method on  "+n);return n}},function(n,e,t){var r=t(28);n.exports=Object("z").propertyIsEnumerable(0)?Object:function(n){return"String"==r(n)?n.split(""):Object(n)}},function(n,e){var t=Math.ceil,r=Math.floor;n.exports=function(n){return isNaN(n=+n)?0:(n>0?r:t)(n)}},function(n,e,t){var r=t(10),o=t(9);n.exports=function(n){return r(o(n))}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}var o=t(0),i=r(o),u=t(19),c=r(u),a=t(1),s=r(a),l=function(n){n?(s.default.error("Hapi initialization failed."),s.default.error(n)):s.default.info("Hapi initialization completed.")},f=function(n,e,r){return i.default.setProvider(function(e){return n(e)||t.i({NODE_ENV:"production",CLIENT_VERSION:"1.0.0"})[e]}),(0,c.default)(r||l)};n.exports=f},function(n,e,t){"use strict";n.exports=function(n){return{method:"GET",path:"/link",handler:{file:"index.html"}}}},function(n,e,t){"use strict";var r=t(7);n.exports=function(n){return{method:"DELETE",path:"/.extensions/on-uninstall",config:{auth:!1,pre:[n.handlers.validateHookToken("/.extensions/on-uninstall"),n.handlers.managementClient]},handler:function(n,e){console.log("Starting uninstall..."),(0,r.uninstall)(n.pre.auth0.rules).then(function(n){return e().code(204)}).catch(function(n){throw console.error("Something went wrong, ",n),n}).catch(function(n){return e.error(n)})}}}},function(n,e,t){"use strict";var r=t(7),o=t(0),i=function(n){return n&&n.__esModule?n:{default:n}}(o);n.exports=function(n){return{method:"POST",path:"/.extensions/on-install",config:{auth:!1,pre:[n.handlers.validateHookToken("/.extensions/on-install"),n.handlers.managementClient]},handler:function(n,e){console.log("Starting rule installation..."),(0,r.install)(n.pre.auth0.rules,{extensionURL:(0,i.default)("PUBLIC_WT_URL")}).then(function(n){return e().code(204)}).then(function(n){console.log("Rule successfully installed")}).catch(function(n){throw console.error("Something went wrong, ",n),n}).catch(function(n){return e.error(n)})}}}},function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n){var e=n.extensionURL,t=void 0===e?"":e,r=n.username;return"function (user, context, callback) {\n    /**\n     * This rule has been automatically generated by\n     * "+(void 0===r?"Unknown":r)+" at "+(new Date).toISOString()+"\n     */\n    var request = require('request@2.56.0');\n    var Promise = require('native-or-bluebird@1.2.0');\n\n    var CONTINUE_PROTOCOL = 'redirect-callback';\n    var config = {\n      endpoints: {\n        linking: '"+t.replace(/\/$/g,"")+"',\n        userApi: auth0.baseUrl + '/users'\n      },\n      token: {\n        clientId: configuration.AUTH0_CLIENT_ID,\n        clientSecret: configuration.AUTH0_CLIENT_SECRET,\n        issuer: configuration.ISSUER\n      }\n    };\n\n    createStrategy().then(callbackWithSuccess).catch(callbackWithFailure);\n\n    function createStrategy() {\n      if (shouldLink()) {\n        return linkAccounts();\n      } else if (shouldPrompt()) {\n        return promptUser();\n      }\n\n      return continueAuth();\n\n      function shouldLink() {\n        return !!context.request.query.link_account_token;\n      }\n\n      function shouldPrompt() {\n        return !insideRedirect() && !redirectingToContinue() && firstLogin();\n\n        // Check if we're inside a redirect\n        // in order to avoid a redirect loop\n        // TODO: May no longer be necessary\n        function insideRedirect() {\n          return context.request.query.redirect_uri &&\n            context.request.query.redirect_uri.indexOf(config.endpoints.linking) !== -1;\n        }\n\n        // Check if this is the first login of the user\n        // since merging already active accounts can be a\n        // destructive action\n        function firstLogin() {\n          return context.stats.loginsCount === 0;\n        }\n\n        // Check if we're coming back from a redirect\n        // in order to avoid a redirect loop. User will\n        // be sent to /continue at this point. We need\n        // to assign them to their primary user if so.\n        function redirectingToContinue() {\n          return context.protocol === CONTINUE_PROTOCOL;\n        }\n      }\n    }\n\n    function linkAccounts() {\n      var secondAccountToken = context.request.query.link_account_token;\n      var uri = config.endpoints.userApi+'/'+user.user_id+'/identities';\n\n      return apiCall({\n        method: 'POST',\n        url: uri,\n        headers: {\n          Authorization: 'Bearer ' + createToken(config.token),\n          'Content-Type': 'application/json',\n          'Cache-Control': 'no-cache'\n        },\n        json: { link_with: secondAccountToken }\n      });\n    }\n\n    function continueAuth() {\n      return Promise.resolve();\n    }\n\n    function promptUser() {\n      return searchUsersWithSameEmail().then(function transformUsers(users) {\n        return users.map(function(user) {\n          return {\n            userId: user.user_id,\n            email: user.email,\n            picture: user.picture,\n            connections: user.identities.map(function(identity) {\n              return identity.connection;\n            })\n          };\n        });\n      }).then(function redirectToExtension(targetUsers) {\n        if (targetUsers.length > 0) {\n          context.redirect = {\n            url: buildRedirectUrl(createToken(config.token, targetUsers), context.request.query)\n          };\n        }\n      });\n    }\n\n    function callbackWithSuccess(_) {\n      // TODO: Ask about this\n      console.info(\"Successfully linked accounts for user: \", user.email);\n      callback(null, user, context);\n\n      return _;\n    }\n\n    function callbackWithFailure(err) {\n      console.error(err.message, err.stack);\n\n      callback(err, user, context);\n    }\n\n    function createToken(tokenInfo, targetUsers) {\n      var options = {\n        expiresInMinutes: 5,\n        audience: tokenInfo.clientId,\n        issuer: qualifyDomain(tokenInfo.issuer)\n      };\n\n      var userSub = {\n        sub: user.user_id,\n        email: user.email,\n        targetUsers: targetUsers,\n        base: auth0.baseUrl\n      };\n\n      return jwt.sign(userSub, tokenInfo.clientSecret, options);\n    }\n\n    function searchUsersWithSameEmail() {\n      return apiCall({\n        url: config.endpoints.userApi,\n        qs: {\n          search_engine: 'v2',\n          q: 'email:\"' + user.email + '\" -user_id:\"' + user.user_id + '\"'\n        }\n      });\n    }\n\n    // Consider moving this logic out of the rule and into the extension\n    function buildRedirectUrl(token, q) {\n      return config.endpoints.linking + '?' +\n        [\n          'child_token=' + token,\n          'client=' + q.client_id,\n          'redirect_uri=' + q.redirect_uri,\n          'scope=' + q.scope,\n          'response_type=' + q.response_type,\n          'auth0Client=' + q.auth0Client\n        ].join('&');\n    }\n\n    function qualifyDomain(domain) {\n      return 'https://'+domain+'/';\n    }\n\n    function apiCall(options) {\n      return new Promise(function(resolve, reject) {\n        var reqOptions = Object.assign({\n          url: options.url,\n          headers: {\n            Authorization: 'Bearer ' + auth0.accessToken,\n            Accept: 'application/json'\n          },\n          json: true\n        }, options);\n\n        request(reqOptions, function handleResponse(err, response, body) {\n          if (err) {\n            reject(err);\n          } else if (response.statusCode < 200 || response.statusCode >= 300) {\n            console.error(\"API call failed: \", body);\n            reject(new Error(body));\n          } else {\n            resolve(response.body);\n          }\n        });\n      });\n    }\n  }"}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(e,"__esModule",{value:!0});var o=t(6),i=t(0),u=r(i),c=t(1),a=r(c),s=function(n,e,t){n.decorate("server","handlers",{managementClient:o.handlers.managementApiClient({domain:(0,u.default)("AUTH0_DOMAIN"),clientId:(0,u.default)("AUTH0_CLIENT_ID"),clientSecret:(0,u.default)("AUTH0_CLIENT_SECRET"),logger:a.default.error}),validateHookToken:o.handlers.validateHookToken((0,u.default)("AUTH0_DOMAIN"),(0,u.default)("WT_URL"),(0,u.default)("EXTENSION_SECRET"))}),t()};s.attributes={name:"handlers"},e.default=s},function(n,e,t){"use strict";(function(n){function r(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(e,"__esModule",{value:!0});var o=t(54),i=r(o),u=t(52),c=r(u),a=t(53),s=r(a),l=t(0),f=r(l),d=t(1),p=r(d),h=t(20),v=r(h),g=t(18),_=r(g),y=function(e){var t=new c.default.Server;return t.connection({host:"localhost",port:(0,f.default)("PORT"),routes:{cors:!0,validate:{},files:{relativeTo:i.default.join(n,"../public")}}}),t.register(s.default,function(){}),t.route({method:"GET",path:"/js/{file*}",handler:{directory:{path:n+"/../public/js"}}}),t.route({method:"GET",path:"/css/{file*}",handler:{directory:{path:n+"/../public/css"}}}),t.register([_.default,v.default],function(n){p.default.debug=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];t.log(["debug"],e.join(" "))},p.default.info=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];t.log(["info"],e.join(" "))},p.default.error=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];t.log(["error"],e.join(" "))},n&&e(n),e(null,t)}),t};e.default=y}).call(e,"/")},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(e,"__esModule",{value:!0});var o=t(14),i=r(o),u=t(16),c=r(u),a=t(15),s=r(a),l=function(n,e){return e.route(n(e))},f=function(n,e,t){l(i.default,n),l(c.default,n),l(s.default,n),t()};f.attributes={name:"routes"},e.default=f},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}var o=t(6),i=r(o),u=t(13),c=r(u),a=t(1),s=r(a),l=t(0),f=r(l),d=i.default.createServer(function(n,e){return s.default.info("Starting Account Link Extension - Version:","1.0.0"),s.default.info(" > WT_URL:",n("WT_URL")),s.default.info(" > PUBLIC_WT_URL:",(0,f.default)("PUBLIC_WT_URL")),(0,c.default)(n,e)});n.exports=function(n,e,t){f.default.setValue("PUBLIC_WT_URL",i.default.urlHelpers.getWebtaskUrl(e)),d(n,e,t)}},function(n,e,t){n.exports={default:t(24),__esModule:!0}},function(n,e,t){"use strict";e.__esModule=!0;var r=t(22),o=function(n){return n&&n.__esModule?n:{default:n}}(r);e.default=o.default||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}},function(n,e,t){t(50),n.exports=t(8).Object.assign},function(n,e){n.exports=function(n){if("function"!=typeof n)throw TypeError(n+" is not a function!");return n}},function(n,e,t){var r=t(5);n.exports=function(n){if(!r(n))throw TypeError(n+" is not an object!");return n}},function(n,e,t){var r=t(12),o=t(46),i=t(45);n.exports=function(n){return function(e,t,u){var c,a=r(e),s=o(a.length),l=i(u,s);if(n&&t!=t){for(;s>l;)if((c=a[l++])!=c)return!0}else for(;s>l;l++)if((n||l in a)&&a[l]===t)return n||l||0;return!n&&-1}}},function(n,e){var t={}.toString;n.exports=function(n){return t.call(n).slice(8,-1)}},function(n,e,t){var r=t(25);n.exports=function(n,e,t){if(r(n),void 0===e)return n;switch(t){case 1:return function(t){return n.call(e,t)};case 2:return function(t,r){return n.call(e,t,r)};case 3:return function(t,r,o){return n.call(e,t,r,o)}}return function(){return n.apply(e,arguments)}}},function(n,e,t){var r=t(5),o=t(4).document,i=r(o)&&r(o.createElement);n.exports=function(n){return i?o.createElement(n):{}}},function(n,e){n.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(n,e,t){var r=t(4),o=t(8),i=t(29),u=t(34),c=function(n,e,t){var a,s,l,f=n&c.F,d=n&c.G,p=n&c.S,h=n&c.P,v=n&c.B,g=n&c.W,_=d?o:o[e]||(o[e]={}),y=_.prototype,m=d?r:p?r[e]:(r[e]||{}).prototype;d&&(t=e);for(a in t)(s=!f&&m&&void 0!==m[a])&&a in _||(l=s?m[a]:t[a],_[a]=d&&"function"!=typeof m[a]?t[a]:v&&s?i(l,r):g&&m[a]==l?function(n){var e=function(e,t,r){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,t)}return new n(e,t,r)}return n.apply(this,arguments)};return e.prototype=n.prototype,e}(l):h&&"function"==typeof l?i(Function.call,l):l,h&&((_.virtual||(_.virtual={}))[a]=l,n&c.R&&y&&!y[a]&&u(y,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,n.exports=c},function(n,e){var t={}.hasOwnProperty;n.exports=function(n,e){return t.call(n,e)}},function(n,e,t){var r=t(37),o=t(42);n.exports=t(2)?function(n,e,t){return r.f(n,e,o(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){n.exports=!t(2)&&!t(3)(function(){return 7!=Object.defineProperty(t(30)("div"),"a",{get:function(){return 7}}).a})},function(n,e,t){"use strict";var r=t(40),o=t(38),i=t(41),u=t(47),c=t(10),a=Object.assign;n.exports=!a||t(3)(function(){var n={},e={},t=Symbol(),r="abcdefghijklmnopqrst";return n[t]=7,r.split("").forEach(function(n){e[n]=n}),7!=a({},n)[t]||Object.keys(a({},e)).join("")!=r})?function(n,e){for(var t=u(n),a=arguments.length,s=1,l=o.f,f=i.f;a>s;)for(var d,p=c(arguments[s++]),h=l?r(p).concat(l(p)):r(p),v=h.length,g=0;v>g;)f.call(p,d=h[g++])&&(t[d]=p[d]);return t}:a},function(n,e,t){var r=t(26),o=t(35),i=t(48),u=Object.defineProperty;e.f=t(2)?Object.defineProperty:function(n,e,t){if(r(n),e=i(e,!0),r(t),o)try{return u(n,e,t)}catch(n){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(n[e]=t.value),n}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var r=t(33),o=t(12),i=t(27)(!1),u=t(43)("IE_PROTO");n.exports=function(n,e){var t,c=o(n),a=0,s=[];for(t in c)t!=u&&r(c,t)&&s.push(t);for(;e.length>a;)r(c,t=e[a++])&&(~i(s,t)||s.push(t));return s}},function(n,e,t){var r=t(39),o=t(31);n.exports=Object.keys||function(n){return r(n,o)}},function(n,e){e.f={}.propertyIsEnumerable},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var r=t(44)("keys"),o=t(49);n.exports=function(n){return r[n]||(r[n]=o(n))}},function(n,e,t){var r=t(4),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});n.exports=function(n){return o[n]||(o[n]={})}},function(n,e,t){var r=t(11),o=Math.max,i=Math.min;n.exports=function(n,e){return n=r(n),n<0?o(n+e,0):i(n,e)}},function(n,e,t){var r=t(11),o=Math.min;n.exports=function(n){return n>0?o(r(n),9007199254740991):0}},function(n,e,t){var r=t(9);n.exports=function(n){return Object(r(n))}},function(n,e,t){var r=t(5);n.exports=function(n,e){if(!r(n))return n;var t,o;if(e&&"function"==typeof(t=n.toString)&&!r(o=t.call(n)))return o;if("function"==typeof(t=n.valueOf)&&!r(o=t.call(n)))return o;if(!e&&"function"==typeof(t=n.toString)&&!r(o=t.call(n)))return o;throw TypeError("Can't convert object to primitive value")}},function(n,e){var t=0,r=Math.random();n.exports=function(n){return"Symbol(".concat(void 0===n?"":n,")_",(++t+r).toString(36))}},function(n,e,t){var r=t(32);r(r.S+r.F,"Object",{assign:t(36)})},function(n,e){n.exports=require("auth0-extension-tools@1.2.1")},function(n,e){n.exports=require("hapi@13.5.0")},function(n,e){n.exports=require("inert")},function(n,e){n.exports=require("path")},function(n,e){n.exports=require("winston@1.0.0")}]);